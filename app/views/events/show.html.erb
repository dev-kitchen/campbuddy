<div class="detail-nav full-row">
  <%= back_or_default_link events_path, class: 'back' %>
  <div class="title">
    <h1><%= @event.title %></h1>
    <h2><%= @event.category.name %></h2>
  </div>
  <% if can? :edit, @event %>
    <%= link_to edit_event_path(back: params[:back]), class: 'edit' do %>
      <%= icon_edit %>
    <% end %>
  <% end %>
</div>

<div class="title-pic full-row">
  <%= image_tag @event.impression.detail.url %>
</div>

<% if can? :create, Attendance %>
  <div class="participation padded-row">
    <% if @event.mandatory? %>
      <div class="mandatory">
        <%= icon_exclamation %>
        <span class="text"><%= t('.mandatory') %></span>
      </div>

    <% elsif @event.groups_only? %>
      <div class="group-only">
        <%= icon_exclamation %>
        <span class="text"><%= t('.groups_only') %></span>
      </div>

    <% elsif @event.owner == current_user %>
      <div class="owner">
        <%= icon_exclamation %>
        <span class="text"><%= t('.you_are_owner') %></span>
      </div>

    <% elsif @event.attended_by_user?(current_user) %>
      <div class="yes" data-attendance-id="<%= @event.attendances.where(user_id: current_user.id).first.id %>" data-event-id="<%= @event.id %>">
        <%= icon_tick css_class: 'green' %><%= icon_cross %>
        <span class="text"><%= t('.you_take_part') %></span>
      </div>

    <% elsif @event.no_places_left? %>
      <div class="occupied">
        <span class="text"><%= t('.full') %></span>
      </div>

    <% else %>
      <div class="no" data-user-id="<%= current_user.id %>" data-event-id="<%= @event.id %>">
        <%= icon_tick %><%= icon_cross css_class: 'red' %>
        <span class="text"><%= t('.attendance') %></span>
      </div>
    <% end %>
  </div>
<% end %>

<div class="event padded-row">
  <ul>
    <li class="description">
      <%= icon_info %>
      <span class="text"><%= @event.description %></span>
    </li>
    <li class="time">
      <%= icon_clock %>
      <span class="text"><%= l @event.starts %> - <%= l @event.ends, format: :time_only %></span>
    </li>
    <% if @event.meeting_point.present? %>
    <li class="meeting_point">
      <%= icon_meeting_point %>
      <span class="text"><%= Event.human_attribute_name :meeting_point %> <%= @event.meeting_point %></span>
    </li>
    <% end %>
    <% if !@event.mandatory? && can?(:read, User) %>
      <li class="partipicants">
        <%= icon_attendees %>
        <span class="text">
          <span class="title"><%= Event.human_attribute_name :users %></span>

          <ul class="attendees">
            <%= render (@event.users - [@event.owner]) %>
            <% if @event.attendance_places_left %>
              <li class="space">
                <div class="count"><%= @event.attendance_places_left %></div>
                <div class="name"><%= Event.human_attribute_name :attendance_places_left %></div>
              </li>
            <% end %>
          </ul>

          <span class="title"><%= Event.human_attribute_name :owner %></span>
          <ul class="attendees">
            <li>
              <div class="image"><%= image_tag @event.owner.avatar.thumb.url %></div>
              <div class="name"><%= @event.owner.fullname %></div>
            </li>
          </ul>
        </span>
      </li>
    <% end %>
  </ul>
</div>
